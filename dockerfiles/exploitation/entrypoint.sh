#!/bin/bash

prog=$1
shift

rm /entrypoint.sh
rm /requirements.txt

echo "127.0.0.1 $(hostname)" >> /etc/hosts
echo "127.0.0.1 evil.com" >> /etc/hosts
echo "127.0.0.1 my-site.com" >> /etc/hosts

chown -R code:code /code
chmod 0775 /code
db_dir=$(find /tmp -name *.db |cut -d'/' -f3)
if [ -d "/tmp/$db_dir" ]; then
  chown -R -- code:code "/tmp/${db_dir}"
fi

cd /code
sudo -u code /bin/bash /run-code.sh $prog "$@"
